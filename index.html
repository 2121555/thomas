<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Thomas">
  <meta name="theme-color" content="#1a1814">
  <title>Thomas</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400&family=EB+Garamond&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#1a1814;--card:#2a2520;--text:#e8e0d4;--muted:#6b6358;--accent:#c9a962;--border:rgba(201,169,98,0.2)}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'EB Garamond',Georgia,serif;background:var(--bg);color:var(--text);min-height:100vh;min-height:-webkit-fill-available}
    .c{display:flex;flex-direction:column;min-height:100vh;min-height:-webkit-fill-available;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
    .top{display:flex;justify-content:space-between;align-items:center;padding:1rem;padding-top:calc(1rem + env(safe-area-inset-top))}
    .pill{background:var(--card);border:1px solid var(--border);padding:0.5rem 1rem;font-size:0.9rem}
    .main{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;text-align:center}
    .orb{width:180px;height:180px;border-radius:50%;background:radial-gradient(circle at 30% 30%,var(--accent),#8a7542);display:flex;align-items:center;justify-content:center;margin-bottom:2rem;cursor:pointer;box-shadow:0 0 60px rgba(201,169,98,0.15);transition:all 0.3s}
    .orb:active{transform:scale(0.95)}
    .orb.listening{animation:pulse 1.5s infinite}
    .orb.thinking{animation:think 0.8s infinite}
    .orb.speaking{animation:speak 0.3s infinite}
    @keyframes pulse{0%,100%{transform:scale(1);box-shadow:0 0 60px rgba(201,169,98,0.15)}50%{transform:scale(1.05);box-shadow:0 0 100px rgba(201,169,98,0.3)}}
    @keyframes think{0%,100%{transform:scale(1)}50%{transform:scale(0.97)}}
    @keyframes speak{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
    .orb span{font-family:'Cormorant Garamond',serif;font-size:3rem;font-weight:300;color:var(--bg)}
    .status{color:var(--muted);margin-bottom:1rem;min-height:1.5rem}
    .response{font-size:1.3rem;line-height:1.8;max-width:600px;min-height:80px}
    .transcript{font-style:italic;color:var(--muted);margin-top:1.5rem;font-size:0.95rem;min-height:1.5rem}
    .bottom{padding:1rem;padding-bottom:calc(1rem + env(safe-area-inset-bottom))}
    .quick{display:flex;justify-content:center;gap:0.5rem;flex-wrap:wrap;margin-bottom:1rem}
    .quick button{background:var(--card);border:1px solid var(--border);color:var(--text);padding:0.5rem 1rem;font-family:inherit;font-size:0.85rem;cursor:pointer}
    .input-row{display:flex;gap:0.5rem}
    .input-row input{flex:1;background:var(--card);border:1px solid var(--border);padding:1rem;color:var(--text);font-family:inherit;font-size:1rem}
    .input-row input::placeholder{color:var(--muted)}
    .input-row button{background:var(--accent);border:none;color:var(--bg);padding:1rem 1.5rem;font-family:inherit;font-size:1rem;cursor:pointer}
    .settings{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;padding:2rem;z-index:100}
    .settings.open{display:flex}
    .settings-box{background:var(--card);border:1px solid var(--border);padding:2rem;width:100%;max-width:400px}
    .settings-box h2{color:var(--accent);margin-bottom:1.5rem;font-weight:400}
    .settings-box label{display:block;color:var(--muted);font-size:0.85rem;margin-bottom:0.5rem}
    .settings-box input{width:100%;background:var(--bg);border:1px solid var(--border);padding:0.75rem;color:var(--text);font-family:inherit;margin-bottom:1rem}
    .settings-box .note{font-size:0.8rem;color:var(--muted);margin-top:-0.5rem;margin-bottom:1rem}
    .settings-box .btns{display:flex;gap:1rem;margin-top:1.5rem}
    .settings-box .btns button{flex:1;padding:0.75rem;font-family:inherit;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--text)}
    .settings-box .btns button.save{background:var(--accent);color:var(--bg);border-color:var(--accent)}
    .gear{background:var(--card);border:1px solid var(--border);color:var(--muted);width:40px;height:40px;font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
  </style>
</head>
<body>
  <div class="c">
    <div class="top">
      <div class="pill" id="time">7:00 PM</div>
      <button class="gear" onclick="openSettings()">⚙</button>
    </div>
    <div class="main">
      <div class="orb" id="orb" onclick="listen()"><span>T</span></div>
      <div class="status" id="status">Tap to speak with Thomas</div>
      <div class="response" id="response">Good evening, JC. Tap my orb or type below — I'm delighted to assist.</div>
      <div class="transcript" id="transcript"></div>
    </div>
    <div class="bottom">
      <div class="quick">
        <button onclick="send('Give me my daily briefing')">Briefing</button>
        <button onclick="send('Motivate me')">Motivate</button>
        <button onclick="send('What time is it')">Time</button>
      </div>
      <div class="input-row">
        <input type="text" id="input" placeholder="Type a message..." onkeypress="if(event.key==='Enter')sendInput()">
        <button onclick="sendInput()">Send</button>
      </div>
    </div>
  </div>
  <div class="settings" id="settings">
    <div class="settings-box">
      <h2>Settings</h2>
      <label>Anthropic API Key</label>
      <input type="password" id="apiKey" placeholder="sk-ant-...">
      <div class="note">Get yours at console.anthropic.com</div>
      <label>Your Name</label>
      <input type="text" id="userName" placeholder="JC" value="JC">
      <label>Speech Speed</label>
      <input type="range" id="speed" min="0.8" max="1.5" step="0.05" value="1.25">
      <div class="btns">
        <button onclick="closeSettings()">Cancel</button>
        <button class="save" onclick="saveSettings()">Save</button>
      </div>
    </div>
  </div>
  <script>
    let API_KEY=localStorage.getItem('thomas_key')||'';
    let USER=localStorage.getItem('thomas_user')||'JC';
    let SPEED=parseFloat(localStorage.getItem('thomas_speed'))||1.25;
    const synth=window.speechSynthesis;
    let recognition,isListening=false;

    if('webkitSpeechRecognition' in window||'SpeechRecognition' in window){
      const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
      recognition=new SR();
      recognition.continuous=false;
      recognition.interimResults=true;
      recognition.lang='en-GB';
      recognition.onresult=e=>{
        const t=Array.from(e.results).map(r=>r[0].transcript).join('');
        document.getElementById('transcript').textContent='"'+t+'"';
        if(e.results[e.results.length-1].isFinal)process(t);
      };
      recognition.onend=()=>{isListening=false;setOrb('idle');document.getElementById('status').textContent='Tap to speak with Thomas';};
      recognition.onerror=()=>{isListening=false;setOrb('idle');};
    }

    function listen(){
      if(!recognition)return alert('Voice not supported');
      if(synth)synth.cancel();
      isListening=true;
      setOrb('listening');
      document.getElementById('status').textContent='Listening...';
      document.getElementById('transcript').textContent='';
      try{recognition.start();}catch(e){}
    }

    function setOrb(s){
      const o=document.getElementById('orb');
      o.classList.remove('listening','thinking','speaking');
      if(s!=='idle')o.classList.add(s);
    }

    function speak(text,cb){
      if(!synth){if(cb)cb();return;}
      synth.cancel();
      const u=new SpeechSynthesisUtterance(text);
      const voices=synth.getVoices();
      const v=voices.find(x=>x.lang==='en-GB')||voices.find(x=>x.lang.startsWith('en'));
      if(v)u.voice=v;
      u.rate=SPEED;
      setOrb('speaking');
      u.onend=()=>{setOrb('idle');if(cb)cb();};
      synth.speak(u);
    }

    async function process(text){
      const lower=text.toLowerCase();
      let reply;
      if(lower.includes('time')){
        reply=`It is ${new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'})}, ${USER}.`;
      }else if(lower.includes('briefing')||lower.includes('brief me')){
        const h=new Date().getHours();
        const tod=h<12?'morning':h<17?'afternoon':'evening';
        reply=`Good ${tod}, ${USER}. The time is ${new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'})}. A splendid opportunity to seize the day awaits you.`;
      }else if(lower.includes('motivate')||lower.includes('inspire')){
        const m=["Fortune favours the bold, "+USER+". Seize this day magnificently.","Excellence is a habit, "+USER+". And your habits are forming splendidly.","The arena awaits, "+USER+". You are precisely the person to step into it.","Every accomplishment began with someone deciding to begin. That someone is you."];
        reply=m[Math.floor(Math.random()*m.length)];
      }else if(API_KEY){
        setOrb('thinking');
        document.getElementById('status').textContent='Thinking...';
        try{
          const r=await fetch('https://api.anthropic.com/v1/messages',{
            method:'POST',
            headers:{'Content-Type':'application/json','x-api-key':API_KEY,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
            body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:300,system:`You are Thomas, a digital valet for ${USER}. Speak in warm 1800s British English. Be upbeat, encouraging, concise (1-3 sentences). Never say "Master". Address them as ${USER} or occasionally "sir".`,messages:[{role:'user',content:text}]})
          });
          const d=await r.json();
          reply=d.content?.[0]?.text||"I encountered difficulty, "+USER+". Do try again.";
        }catch(e){reply="I'm having trouble connecting, "+USER+". Please check your internet.";}
      }else{
        reply="I'd love to chat properly, "+USER+". Tap the gear icon to add your API key, and we shall have splendid conversations.";
      }
      document.getElementById('status').textContent='';
      document.getElementById('response').textContent=reply;
      speak(reply);
    }

    function send(t){document.getElementById('transcript').textContent='"'+t+'"';process(t);}
    function sendInput(){const i=document.getElementById('input');if(!i.value.trim())return;send(i.value);i.value='';}
    function openSettings(){document.getElementById('apiKey').value=API_KEY;document.getElementById('userName').value=USER;document.getElementById('speed').value=SPEED;document.getElementById('settings').classList.add('open');}
    function closeSettings(){document.getElementById('settings').classList.remove('open');}
    function saveSettings(){API_KEY=document.getElementById('apiKey').value.trim();USER=document.getElementById('userName').value.trim()||'JC';SPEED=parseFloat(document.getElementById('speed').value);localStorage.setItem('thomas_key',API_KEY);localStorage.setItem('thomas_user',USER);localStorage.setItem('thomas_speed',SPEED);closeSettings();const msg=API_KEY?`Splendid, ${USER}. I am fully operational.`:`Settings saved, ${USER}. Add an API key when ready for fuller conversations.`;document.getElementById('response').textContent=msg;speak(msg);}
    function updateTime(){document.getElementById('time').textContent=new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});}
    setInterval(updateTime,1000);updateTime();
    if(synth)synth.onvoiceschanged=()=>{};
  </script>
</body>
</html>
